<!DOCTYPE html>
{% load static %}
{% load humanize %}
{% load mathfilters %}


<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>GPR-ProMan</title>
    
    <link rel="stylesheet" href="{% static 'css/css/materialdesignicons.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/custom.css' %}">
    <link rel="stylesheet" href="{% static 'css/custom-modal.css' %}">
    <link rel="stylesheet" href="{% static 'css/sweetalert.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/invoice1.css' %}">


  </head>
  <body>
    <!-- <button onclick="Convert_HTML_To_PDF();">Convert HTML to PDF</button> -->
    <br><br>
      <button type="button"  onclick="location.href='/{{pdata.pj}}/invoiceslist/Issued/'" class="btn2 btn2-info">Invoice List</button>
      <button type="button"  id="btnTest" onclick="href='javascript:generatePDF()'" class="btn2 btn2-primary">Download</button>
    {% if inv.Lock_Status == 1 %}
      <button type="button" ht='unlock it for edit/change the invoice' id='hidelockbutton' data-toggle="modal" data-target="#unlockPasswordModal" onclick="javascript:fnc('unlockinvoice')" class="btn2 btn2-danger">Unlock Invoice</button>
    {% else %}
      <button type="button" ht='by click this confirm invoice and lock edit options' data-toggle="modal" data-target="#editInvoiceModal" onclick="javascript:fnc('lockinvoice')" class="btn2 btn2-danger">Convert As Main Invoice</button>
      <button type="button" ht='by click this make proforma invoice' data-toggle="modal" data-target="#editInvoiceModal" onclick="javascript:fnc('proformainvoice')" class="btn2 btn2-info">Convert As Proforma</button>
      <button type="button" ht='Delete this Draft Invoice' data-toggle="modal" data-target="#deleteInvoiceModal" onclick="javascript:fnc('deleteinvoice')" class="btn2 btn2-dark">Delete</button>
      
      <div><h5 style="float:right; color:blue;">Draft Copy</h5></div>

      <div class="modal fade text-left" id="deleteInvoiceModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content" id="modal-reload">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel" style="font-weight:bold; font-size: 15px;">Enter Security Password Before Delete</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form class="forms-sample">
                <div class="form-group">
                  <label for="exampleInputPassword1">Password</label>
                  <input type="password" class="form-control"  placeholder="Acctivity Password" ><br/>
                  <input type="button" class="btn2 btn2-primary" value="Submit"  onclick="javascript:deleteinvoice('sse123')" />
                </div> 
              </form>
            </div>
          </div>
        </div>
      </div>
    {% endif %}


{{msgs}}
      {% if messages %}
        {% for msg in messages %}
            {% if msg.tags == 'success' %}
              {{msg}}
            {% endif %}
        {% endfor %}
      {% endif %}
    
    <br><br>
    <script>var hide1=1; var hide2=1; var hide3=1;</script>

    <div id="invoicee" class="print">
      <table style="width:100%">
        <tbody>
          <tr>
            <td class="t2" style="background: white; text-align:left; width:15%"><img  class="invlogo" src="{% static 'img/logo-sss.png' %}"></td>
            <td  class="t1" style="">
              <span style="font-size:20px; color:yellow; ">{{inv.Billing_From.Company_Name}}</span>
              <a class="ahr1" ht="Change BillingFromAddress" data-toggle="modal" data-target="#editInvoiceModal" onclick="javascript:fnc('companyaddress')"><span style="font-style:italic; color: white;">
              <br>{{inv.Billing_From.Address_Line_1}},
              <br>{{inv.Billing_From.Address_Line_2}}, {{inv.Billing_From.State}}.
              </span></a>
            </td>
            <td class="t2" style="font-size:20px; ">
            {% if inv.Lock_Status == 0 %}Invoice Draft Copy&nbsp;
            {% elif inv.Is_Proforma == 1 %}PROFORMA INVOICE&nbsp;{% else %}INVOICE&nbsp;{% endif %}</td>
          </tr> 
        </tbody>
      </table>
      
      <div style="margin-top:5px"></div>
      <table class="t3">
        <tr>
          <th class="th1">Company Details</th>
          <th class="th1">Invoice and Delivery Details</th>
        </tr>
        <tr>
          <th class="td1">
            <a class="ahr" ht="Change BillingFrom Details" data-toggle="modal" data-target="#editInvoiceModal" onclick="javascript:fnc('companyaddress')">
              <span class="sh1">    Phone&emsp; </span>{{inv.Billing_From.Phone_Number_1}}{% if inv.Billing_From.Phone_Number_2 %}, {{inv.Billing_From.Phone_Number_2}}{% endif %}
              <br><span class="sh1">Mail&emsp;&emsp; </span>{{inv.Billing_From.Email}}
              {% if inv.Billing_From.GST_No %}<br><span class="sh1">GSTIN &nbsp;&nbsp; </span>{{inv.Billing_From.GST_No}}{% endif %}
              <br><span class="sh1">State&emsp;&nbsp;&thinsp; </span>Telangana{% if inv.Billing_From.State_Code %}, <span class="sh1">Code: </span>{{inv.Billing_From.State_Code}}{% endif %}
            </a>
          </th>
          <th class="td1">
            <a class="ahr" ht="Edit Invoice Details" data-toggle="modal" data-target="#editInvoiceModal" onclick="javascript:fnc('invoicedetails')">
              {% if inv.Is_Proforma == 0 %}
                <span class="sh1">Invoice No & Date:</span> {{inv.Invoice_No}}, {{inv.Invoice_Date|date:'d M Y'}}
                <br><span class="sh1">Due Date: </span>{{inv.Payment_Due_Date}}, <span class="sh1">Due Amount: </span>{% if inv.Due_Amount > 0 %}â‚¹ {{inv.Due_Amount|floatformat:0|intcomma}}{% else %}0{% endif %}
              {% else %}
                <span class="sh1">PI No & Date:</span> {{inv.Invoice_No}}, {{inv.Invoice_Date|date:'d M Y'}}
              {% endif %}

            </a>
              {% if inv.Order.PO_No %}<br><span class="sh1">PO No & Date:</span> {{inv.Order.PO_No}}, {{inv.Order.Order_Received_Date|date:'d M Y'}}{% endif %}
              {% if inv.Delivery_Note %}
                <a class="ahr" ht="Edit Delivery Note Details" data-toggle="modal" data-target="#editDeliveryNoteModal" onclick="javascript:editdeliverynote({{inv.Delivery_Note.id}})">
                {% if inv.Delivery_Note.Transport_Mode %}<br><span class="sh1">Dispatch Through: </span>{{inv.Delivery_Note.Transport_Mode}},{% else %}<br>{% endif %} {% if inv.Delivery_Note.Vehicle_No %}<span class="sh1">Vehicle No: </span>{{inv.Delivery_Note.Vehicle_No}}{% endif %}
                {% if inv.Delivery_Note.Place_Of_Supply %}<br><span class="sh1">Place of Supply: </span>{{inv.Delivery_Note.Place_Of_Supply}}. {% else %}<br>{% endif %}{% if inv.Delivery_Note.LRR_No %}<span class="sh1">LRR No: </span>{{inv.Delivery_Note.LRR_No}}{% endif %}
                </a>
                <script>var hide1=0;</script>
              {% else %}
                {% if inv.Lock_Status == 0  %}<button type="button" id='hideadddeliverynotebutton' data-toggle="modal" data-target="#DeliveryNoteModal" onclick="javascript:fnc('adddeliverynote')" class="btn1 btn1-sm btn1-primary">+Add Delivery Details</button>{% endif %}
              {% endif %}
          </th>
        </tr>
      </table>
      <div style="margin-top:5px"></div>
      <table class="t3">
        <tr>
          <th class="th1">Buyer (Bill To)</th>
          <th class="th1">Consignee (Ship To)</th>
        </tr>
        <tr>
          <th class="td1">
            <a class="ahr" ht="Change Billing Address" data-toggle="modal" data-target="#editInvoiceModal" onclick="javascript:fnc('billingaddress')">
              <span class="sh1">M/s. {{inv.Billing_To.Customer_Name}}</span>
              {% if inv.Billing_To.Address_Line_1 %}<br>{{inv.Billing_To.Address_Line_1}},{% endif %}
              {% if inv.Billing_To.Address_Line_2 %}<br>{{inv.Billing_To.Address_Line_2}},{% endif %}
              {% if inv.Billing_To.GST_No %}<br><span class="sh1">GSTIN : </span>{{inv.Billing_To.GST_No}},{% endif %}
              <br><span class="sh1">State &nbsp; : </span>{{inv.Billing_To.State}}{% if inv.Billing_To.State_Code %}, <span class="sh1">Code: </span>{{inv.Billing_To.State_Code}}{% endif %} 
            </a>
          </th>
          <th class="td1">
            <a class="ahr" ht="Change Shipping Address" data-toggle="modal" data-target="#editInvoiceModal" onclick="javascript:fnc('shippingaddress')">
              <span class="sh1">M/s. {{inv.Shipping_To.Customer_Name}}</span>
              {% if inv.Shipping_To.Address_Line_1 %}<br>{{inv.Shipping_To.Address_Line_1}},{% endif %}
              {% if inv.Shipping_To.Address_Line_2 %}<br>{{inv.Shipping_To.Address_Line_2}},{% endif %}
              {% if inv.Shipping_To.GST_No %}<br><span class="sh1">GSTIN : </span>{{inv.Shipping_To.GST_No}},{% endif %}
              <br><span class="sh1">State &nbsp; : </span>{{inv.Shipping_To.State}}{% if inv.Shipping_To.State_Code %}, <span class="sh1">Code: </span>{{inv.Shipping_To.State_Code}}{% endif %}
            </a>
          </th>
        </tr>
      </table>
      <div style="margin-top:10px"></div>
      {% if itm %}
        <table class="t3" style="font-size:11px">
          <tr>
            <th class="th2" style="width:4%">#</th>
            <th class="th2" >Description of Goods</th>
            <th class="th2" style="width:7%">HSN</th>
            <th class="th2" style="width:7.5%">Quantity</th>
            <th class="th2" style="width:9%">Rate</th>
            <th class="th2" style="width:9%">Amount</th>
            {% if inv.Billing_To.State == inv.Billing_From.State %}
              <th class="th2" style="width:8%">CGST</th>
              <th class="th2" style="width:8%">SGST</th>
            {% else %}
              <th class="th2" style="width:9%">IGST</th>
            {% endif %}
            <th class="th2" style="text-align:right; width:12%">Total Amount</th>
          </tr>
          {% for x, a, b, c in itm %}
            <tr>
              <th class="td2">{{forloop.counter}}</th>
              <th class="td2" style="font-weight:bold"><a class="ahr" ht="Edit/Delete Item Details" data-toggle="modal" data-target="#itemEditButtons" onclick="javascript:edititem({{x.id}})">{{x.Item_Description}}</a></th>
              <th class="td2">{{x.HSN_Code}}</th>
              <th class="td2">{% if x.UOM == 'Kg' or x.UOM == 'Mtr' or x.UOM == 'Ltr' %}{{x.Quantity|floatformat:2}}{% else %}{{x.Quantity|floatformat:0}}{% endif %}
                <br><span style="font-weight:bold; font-style:italic;">{{x.UOM}}{% if x.Quantity > 1 %}s{% endif %}</span></th>
              <th class="td2">{{x.Unit_Price|floatformat:'0'}}</th>
              <th class="td2">{{a|floatformat:'0'}}</th>
              {% if inv.Billing_To.State == inv.Billing_From.State %}
                <th class="td2">{{b|div:2|floatformat:'0'}}<br><span style="font-style:italic">{{x.GST|div:2|floatformat:'1'}}%</span></th>
                <th class="td2">{{b|div:2|floatformat:'0'}}<br><span style="font-style:italic">{{x.GST|div:2|floatformat:'1'}}%</span></th>
              {% else %}
                <th class="td2">{{b|floatformat:'0'}}<br><span style="font-style:italic">{{x.GST|floatformat:'1'}}%</span></th>
              {% endif %}
              <th class="td2" style="font-weight:bold;text-align:right;">{{c|floatformat:'0'|intcomma}}</th>
            </tr>
          {% endfor %}
        </table>
        {% if inv.Lock_Status == 0 %}
          <button type="button" id='hideitembutton' data-toggle="modal" data-target="#addNewItemModal" onclick="javascript:fnc('addnewitem')" class="btn2 btn2-sm btn2-primary">+Add New Item</button>
          <script> var hide4=1;</script>
        {% endif %}
        

        <table class="t3" style="float:right; width: 41%; font-size: 11px;">
          <tr>
            <th class="th1" style="text-align: right;">Total Amount Before Tax</th>
            <th class="td2" style="width:40%; text-align: right; font-weight: bold; ">{{ss.final_without_tax_amount|floatformat:'2'|intcomma}}</th>
          </tr>
          {% if inv.Billing_To.State == inv.Billing_From.State %}
            <tr>
              <th class="th1" style="text-align: right;">Add: CGST</th>
              <th class="td2" style="width:30%; text-align: right;">{{ss.final_gst|div:2|floatformat:'2'|intcomma}}</th>
            </tr>
            <tr>
              <th class="th1" style="text-align: right;">Add: SGST</th>
              <th class="td2" style="width:30%; text-align: right;">{{ss.final_gst|div:2|floatformat:'2'|intcomma}}</th>
            </tr>
          {% else %}
            <tr>
              <th class="th1" style="text-align: right;">Add: IGST</th>
              <th class="td2" style="width:30%; text-align: right;">{{ss.final_gst|floatformat:'2'|intcomma}}</th>
            </tr>
          {% endif %}
          <tr>
            <th class="th1" style="text-align: right;">Total GST Amount</th>
            <th class="td2" style="width:30%; text-align: right; font-weight: bold;">{{ss.final_gst|floatformat:'2'|intcomma}}</th>
          </tr>
          <tr>
            <th class="th1" style="text-align: right; ">Total Amount After Tax</th>
            <th class="td2" style="width:30%; text-align: right; font-weight: bold;font-size: 12px;">â‚¹ {{ss.final_with_tax_amount|floatformat:'0'|intcomma}}</th>
          </tr>
          <tr>
            <th colspan="2" class="td1" style="border:none; font-size:11px; padding-top: 1px; font-style: italic; text-align: right;">
              <a class="ahr" ht="Change GST payable on reverse chargs" data-toggle="modal" data-target="#editInvoiceModal" onclick="javascript:fnc('gstreverse')">
                {% if inv.GST_Reverse_Charges == 0 %}GST payable on reverse chargs - Nill{% else %}Amount of Tax Subject to Reverse Charge{% endif %}</a> <span style="font-weight:normal;  margin-top:1px; margin-left: 35px;">(E. & O.E)</span>
              </th>
          </tr>
          <tr>
            <th colspan="2" class="td1" style="border:none; padding-top: 1px; font-style: italic; font-size:12.5px; width: 38%; font-weight: bold; text-align: right;">
              For M/s {{inv.Billing_From.Company_Name}}
              <br><div style="margin-top:70px; font-size:11.5px">Authorised Signatory</div>
            </th>
          </tr>
          <tr>
        </table>

        {% if len_words > 60 %}
          <div style="text-transform: capitalize; margin-top: 10px; margin-bottom: 18px; color:black; font-size:12px; font-style: italic; font-weight:normal"><span style="font-weight:bold; font-style: normal;">Total Invoiced Amount in Words: </span>{{amount_in_words}} Rupees Only</div>
        {% else %}
        <div style="text-transform: capitalize; margin-top: 10px; margin-bottom: 18px; color:black; font-size:12px; font-style: italic; font-weight:normal"><span style="font-weight:bold; font-style: normal;">Total Invoiced Amount in Words<br></span>{{amount_in_words}} Rupees Only</div>
        {% endif %}
        
        {% if inv.Bank_Details %}
          <table class="t3" style="width:59%">
            <tr>
              <th class="th1" style="padding:5.5px;">Bank Account Details</th>
            </tr>
            <tr>
              <th class="td1">
                <a class="ahr" ht="Change Bank Account Details" data-toggle="modal" data-target="#editInvoiceModal" onclick="javascript:fnc('bankaccount')">
                  <span class="sh1">Account No:&nbsp; </span>{{inv.Bank_Details.Account_No}} &emsp;<span class="sh1">Bank: </span>{{inv.Bank_Details.Bank_Name}}
                  <br><span class="sh1">Branch: </span>{{inv.Bank_Details.Branch}}
                  <br><span class="sh1">IFSC Code: </span>{{inv.Bank_Details.IFSC_Code}}
                </a>
              </th>
            </tr>
          </table>
          <script>var hide3=0;</script>
        {% else %}
          {% if inv.Lock_Status == 0 %}<button type="button" id='hideaddbankdetailsbutton' data-toggle="modal" data-target="#editInvoiceModal" onclick="javascript:fnc('addbankdetails')" class="btn1 btn1-sm btn1-success">+Add Bank Details</button>{% endif %}
        {% endif %}
        <div style="margin-top:3px"></div>

        {% if tc %}
          <table class="t3" style="width:59%; float:right; margin-bottom: 5px;">
            <tr>
              <th class="th1">Terms and Conditions</th>
            </tr>
            <tr>
              <th class="td1">
                <a class="ahr" ht="Edit Terms and Conditions" data-toggle="modal" data-target="#editTCModal" onclick="javascript:edittc({{tc.id}})">
                  {% if tc.Terms_and_Condition1 %}{{tc.Terms_and_Condition1}}{% endif %}
                  {% if tc.Terms_and_Condition2 %}<br>{{tc.Terms_and_Condition2}}{% endif %}
                  {% if tc.Terms_and_Condition3 %}<br>{{tc.Terms_and_Condition3}}{% endif %}
                  {% if tc.Terms_and_Condition4 %}<br>{{tc.Terms_and_Condition4}}{% endif %}
                </a>
              </th>
            </tr>
          </table>
          <script>var hide2=0;</script>
        {% else %}
          {% if inv.Lock_Status == 0 %}<button type="button" id='hideaddtcbutton' data-toggle="modal" data-target="#TCModal" onclick="javascript:fnc('addtc')" class="btn1 btn1-sm btn1-info">+Add Terms and Conditions</button> {% endif %}
        {% endif %}

        <div style="margin-top: 10px; margin-bottom: 3px; color:black; font-size:12px; font-style: italic; font-weight:normal"><span style="font-weight:bold; font-style: normal;">Decleration: </span> We declare that this invoice shows the actual price of the goods described and that all particulars are true and correct</div>
        <!-- {% if tc.Additional_Note %}
        <a class="ahr" ht="Edit Terms and Conditions" data-toggle="modal" data-target="#exampleModal13" onclick="javascript:fnc('tc')"><div style="margin-top: 10px; margin-bottom: 6px; color:black; font-size:12px; font-style: italic; font-weight:normal"><span style="font-weight:bold; font-style: normal;">Note: </span>{{tc.Additional_Note}}</div></a>
        {% endif %} -->
      {% endif %}
      

      <div id="nextpage1"></div>
    </div>

    {% if inv.Lock_Status == 1 %}
    <style type="text/css">a:hover {cursor:pointer; pointer-events: none; }</style>
    {% endif %}

  
<!-- Invoice Addresses and Details Update Popups - Buttons and Forms -->
  <div class="modal fade text-left" id="editInvoiceModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" >
      <div class="modal-content" id="modal-reload">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel" style="font-weight:bold; font-size: 15px;">Invoice Details Update Form</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">   
          <form class="forms-sample" action="" id='inv_edit_action' method="POST" enctype="multipart/form-data">
            <div class="form-group mb-4">
              {% csrf_token %}
              <div class="form-group">

                <div style="display:none;" id='billingfrom'><label for="{{ field.label }}">{{ form_invoice.Billing_From.label }}{% if field.field.required %} <span style="color: red">**</span> {% endif %}</label>{{ form_invoice.Billing_From }}</div>

                <div style="display:none;" id='invoiceno'>
                  <label for="{{ field.label }}">{{ form_invoice.Invoice_No.label }}{% if field.field.required %} <span style="color: red">**</span> {% endif %}</label>{{ form_invoice.Invoice_No }}
                  <label for="{{ field.label }}">choose Invoice No format if want to change default format as above{% if field.field.required %} <span style="color: red">**</span> {% endif %}</label>{{ form_invoice.Invoice_No_Format }}
                  <label for="{{ field.label }}">{{ form_invoice.Invoice_Date.label }}{% if field.field.required %} <span style="color: red">**</span> {% endif %}</label>{{ form_invoice.Invoice_Date }}
                  <label for="{{ field.label }}">{{ form_invoice.Credit_Days.label }}{% if field.field.required %} <span style="color: red">**</span> {% endif %}</label>{{ form_invoice.Credit_Days }}
                </div>

                <div style="display:none;" id='billingto'><label for="{{ field.label }}">{{ form_invoice.Billing_To.label }}{% if field.field.required %} <span style="color: red">**</span> {% endif %}</label>{{ form_invoice.Billing_To }}</div>

                <div style="display:none;" id='shippingto'><label for="{{ field.label }}">{{ form_invoice.Shipping_To.label }}{% if field.field.required %} <span style="color: red">**</span> {% endif %}</label>{{ form_invoice.Shipping_To }}</div>

                <div style="display:none;" id='bank_details'><label for="{{ field.label }}">{{ form_invoice.Bank_Details.label }}{% if field.field.required %} <span style="color: red">**</span> {% endif %}</label>{{ form_invoice.Bank_Details }}</div>

                <div class="form-check"  style="display:none; " id='gst_reverse'>
                  <label class="form-check-label">{{ form_invoice.GST_Reverse_Charges }} Mark it if GST Reverse Charges Applicable</label><br>
                </div>

                <div class="form-check"  style="display:none; " id='lock_invoice'>
                  <label class="form-check-label">{{ form_invoice.Lock_Status }}</label><br><span style="font-size:17px;">Are You Sure !<br>Once You Lock It You Can't Modify/Edit Invoice Without Unlock Password<br>Tick Above Box and Submit to Lock the Invoice</span>
                </div>

                <div class="form-check"  style="display:none; " id='proforma_invoice'>
                  <label class="form-check-label">{{ form_invoice.Is_Proforma }}</label><br><span style="font-size:17px;">Are You Sure Wanr to Convert as Proforma Invoice !<br>Once You Lock It You Can't Modify/Edit Proforma Invoice Without Unlock Password<br>Tick Above Box and Submit to Lock the Proforma Invoice</span>
                </div>

              </div>
              <button type="submit" class="btn btn-primary">Submit</button>    
            </div>
        </form>
        </div>
      </div>
    </div>
  </div>
<!-- End -->

<!-- Invoice Unlock Forms and Password Popup-->
  <form class="forms-sample" action="" id='unlockinvoiceaction' method="POST" enctype="multipart/form-data" style="display: none;">
    <div class="form-group mb-4">
      {% csrf_token %}
      <div class="form-group newheight">
        {% for field in form_invoice %}
          {% if field.label != 'Lock Status' and field.label != 'Is Proforma' %}
            <label for="{{ field.label }}">{{ field.label }}{% if field.field.required %} <span style="color: red">**</span> {% endif %}</label>{{ field}}
          {% endif %}           
          {% if field.label == 'Lock Status' %}
            <input  type="checkbox" name="Lock_Status" value="0" >
          {% endif %}
          {% if field.label == 'Is Proforma' %}
            <input  type="checkbox" name="Is Proforma" value="0" >
          {% endif %}
          {% for error in field.errors %}
            <p style="color: red; margin-top: -20px">{{ error }}</p>
          {% endfor %}
        {% endfor %}
      </div>
   </div>
  <button type="submit" class="btn btn-primary" id='unlocksubmit'>Submit</button>    
  </form>

  <div class="modal fade text-left" id="unlockPasswordModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content" id="modal-reload">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel" style="font-weight:bold; font-size: 15px;">Enter Security Password to Unlock Invoice to Edit Data</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form class="forms-sample">
            <div class="form-group">
              <label for="exampleInputPassword1">Password</label>
              <input type="password" class="form-control"  placeholder="Acctivity Password" id="unlockpassword"><br/>
              <input type="button" class="btn2 btn2-primary" value="Submit"  onclick="javascript:validateinvoicepswd('sse123')" />
            </div> 
          </form>
        </div>
      </div>
    </div>
  </div>
<!-- End -->
  
<!-- Delevery Note Add, Update or Delete Popups - Buttons and Forms -->
  <div class="modal fade text-left" id="editDeliveryNoteModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" style="width:250px;%">
      <div class="modal-content" id="modal-reload">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel" style="font-weight:bold; font-size: 15px;">Action Window</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="template-demo">
            <button type="button" data-toggle="modal" data-target="#DeliveryNoteModal" class="btn btn-sm btn-primary mb-2">Edit Delivery Details</button>
            <button type="button"  onclick="location.href='/{{pdata.pj}}/delete/inv_deliverynote/'+{{inv.id}}+'/'+getid+'/'" class="btn btn-sm btn-danger mb-2">Delete Delivery Details</button>            
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Delevery Note Add, Update Form -->
  <div class="modal fade text-left" id="DeliveryNoteModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" >
      <div class="modal-content" id="modal-reload">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel" style="font-weight:bold; font-size: 15px;">Add/Update Delivery Details Form</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">   
          <form class="forms-sample" action="" id='deliveryaction' method="POST" enctype="multipart/form-data">
            <div class="form-group mb-4">
              {% csrf_token %}
              <div class="form-group newheight">
                {% for field in form_deliverynote %}
                    <label for="{{ field.label }}">{{ field.label }}{% if field.field.required %} <span style="color: red">**</span> {% endif %}</label>{{ field}}
                  {% for error in field.errors %}
                    <p style="color: red; margin-top: -20px">{{ error }}</p>
                  {% endfor %}
                {% endfor %}
              </div>
           </div>
          <button type="submit" class="btn btn-primary">Submit</button>    
        </form>
        </div>
      </div>
    </div>
  </div>
<!-- End -->


<!-- Terms and Conditions Add, Update or Delete Popups - Buttons and Forms -->
  <div class="modal fade text-left" id="editTCModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" style="width:250px;%">
      <div class="modal-content" id="modal-reload">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel" style="font-weight:bold; font-size: 15px;">Action Window</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="template-demo">
            <button type="button" data-toggle="modal" data-target="#TCModal" class="btn btn-sm btn-primary mb-2">Edit T&C</button>
            <button type="button"  onclick="location.href='/{{pdata.pj}}/delete/inv_tc/'+{{inv.id}}+'/'+getid+'/'" class="btn btn-sm btn-danger mb-2">Delete T&C</button>            
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Terms and Conditions Add, Update or Delete Form -->
  <div class="modal fade text-left" id="TCModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" >
      <div class="modal-content" id="modal-reload">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel" style="font-weight:bold; font-size: 15px;">Update Terms and Condition Form</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">   
          <form class="forms-sample" action="" id='tcaction' method="POST" enctype="multipart/form-data">
            <div class="form-group mb-4">
              {% csrf_token %}
              <div class="form-group newheight">
                {% for field in form_tc %}
                  {% if field.label != 'Additional Note' %}
                    <label for="{{ field.label }}">{{ field.label }}{% if field.field.required %} <span style="color: red">**</span> {% endif %}</label>{{ field}}
                  {% endif %}
                  {% for error in field.errors %}
                    <p style="color: red; margin-top: -20px">{{ error }}</p>
                  {% endfor %}
                {% endfor %}
              </div>
           </div>
          <button type="submit" class="btn btn-primary">Submit</button>    
        </form>
        </div>
      </div>
    </div>
  </div>
<!-- End -->
  
<!-- Items Add, Update or Delete Popups - Buttons and Forms -->
  <!-- when click this modal on item description, it will open below two buttons. when you click update item, it will take this id, and return same page with id instaed of 'itemid'. below itemclick button auto activate modal01(item form with edit data) when load page  -->
  <div class="modal fade text-left" id="itemEditButtons" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" style="width:250px;%">
      <div class="modal-content" id="modal-reload">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel" style="font-weight:bold; font-size: 15px;">Action Window</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="template-demo">
            <button type="button" onclick="location.href='/{{pdata.pj}}/invoice/edit/'+{{inv.id}}+'/'+{{inv.Order.id}}+'/'+getid+'/msg/'" class="btn btn-sm btn-primary mb-2">Update Item</button>
            <button type="button"  onclick="location.href='/{{pdata.pj}}/delete/invoiceitem/'+{{inv.id}}+'/'+getid+'/'" class="btn btn-sm btn-danger mb-2">Delete Item</button>            
          </div>
        </div>
      </div>
    </div>
  </div>
  <button type="button" style="display:none" data-toggle="modal" data-target="#addNewItemModal" data-backdrop='static' data-keyboard='false' id='itemidclick' class="btn btn-sm btn-primary mb-2">Update Item</button>

<!-- Add/Edit Items Form -->
  <div class="modal fade text-left" id="addNewItemModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" >
      <div class="modal-content" id="modal-reload">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel" style="font-weight:bold; font-size: 15px;">Item Update Form</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="location.href='/{{pdata.pj}}/invoice/edit/'+{{inv.id}}+'/'+{{inv.Order.id}}+'/'+'itemid/msg/'">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">   
          <form class="forms-sample" action="" id='itemaction' method="POST" enctype="multipart/form-data">
            <div class="form-group mb-4">
              {% csrf_token %}
              <div class="form-group newheight">
                {% for field in form_item %}
                    <label for="{{ field.label }}">{{ field.label }}{% if field.field.required %} <span style="color: red">**</span> {% endif %}</label>{{ field}}
                  {% for error in field.errors %}
                    <p style="color: red; margin-top: -20px">{{ error }}</p>
                  {% endfor %}
                {% endfor %}
              </div>
           </div>
          <button type="submit" class="btn btn-primary" >Submit</button>    
        </form>
        </div>
      </div>
    </div>
  </div>
<!-- End -->


  <script type="text/javascript">  
    function fnc(tag) {
      document.getElementById("inv_edit_action").action = '/{{pdata.pj}}/inv_edit/edit/'+{{inv.id}}+'/';

      if ( tag == 'companyaddress' ) {document.getElementById("billingfrom").style.display = 'block';}
      else {document.getElementById("billingfrom").style.display = 'none';};

      if ( tag == 'invoicedetails' ) {document.getElementById("invoiceno").style.display = 'block';}      
        else {document.getElementById("invoiceno").style.display = 'none';};

      if ( tag == 'billingaddress' ) {document.getElementById("billingto").style.display = 'block';}      
        else {document.getElementById("billingto").style.display = 'none';};

      if ( tag == 'shippingaddress' ) {document.getElementById("shippingto").style.display = 'block';}      
        else {document.getElementById("shippingto").style.display = 'none';};
      
      if ( tag == 'bankaccount' | tag == 'addbankdetails'  ) { document.getElementById("bank_details").style.display = 'block';}      
        else {document.getElementById("bank_details").style.display = 'none';};

      if ( tag == 'gstreverse' ) { document.getElementById("gst_reverse").style.display = 'block';}     
        else {document.getElementById("gst_reverse").style.display = 'none';};

        if ( tag == 'lockinvoice' ) { document.getElementById("lock_invoice").style.display = 'block'; var lock=1;}     
        else {document.getElementById("lock_invoice").style.display = 'none';};

        if ( tag == 'proformainvoice' ) { document.getElementById("proforma_invoice").style.display = 'block'; var lock=1;}     
        else {document.getElementById("proforma_invoice").style.display = 'none';};    

      // if ( tag == 'tc' ) {document.getElementById('tc').style.display = 'block';}
      // else {document.getElementById("tc").style.display = 'none';};
      
      if ( tag == 'addnewitem' ) {document.getElementById("itemaction").action = '/{{pdata.pj}}/create/invoiceitem/'+{{inv.id}}+'/'+tag+'/';}

      if ( tag == 'adddeliverynote' ) {document.getElementById("deliveryaction").action = '/{{pdata.pj}}/create/inv_deliverynote/'+{{inv.id}}+'/1/';}

      if ( tag == 'addtc' ) {document.getElementById("tcaction").action = '/{{pdata.pj}}/create/inv_tc/'+{{inv.id}}+'/1/';}
    }

      function editdeliverynote(id){
        getid = id;
        document.getElementById("deliveryaction").action = '/{{pdata.pj}}/edit/inv_deliverynote/'+{{inv.id}}+'/'+id+'/';}

      function edittc(id){
        getid = id;
        document.getElementById("tcaction").action = '/{{pdata.pj}}/edit/inv_tc/'+{{inv.id}}+'/'+id+'/';}

      function edititem(id) {getid = id;}

      function validateinvoicepswd(pswd) { 
        if ( pswd == 'sse123') {
          document.getElementById("unlockinvoiceaction").action = '/{{pdata.pj}}/inv_edit/edit/'+{{inv.id}}+'/';
          document.getElementById("unlocksubmit").click();}
        else { alert('Password did not matched. Please Try Again')}
        }
      function deleteinvoice(){location.href='/{{pdata.pj}}/inv_edit/delete/'+{{inv.id}}+'/'}

  </script>

  <script>
    function test() {
      if ('{{inv.Lock_Status}}' == 'False') {
      if(hide1!=0){document.getElementById("hideadddeliverynotebutton").style.display = 'none';}
      if(hide2!=0){document.getElementById("hideaddtcbutton").style.display = 'none';}
      if(hide3!=0){document.getElementById("hideaddbankdetailsbutton").style.display = 'none';}
      if(hide4!=0){document.getElementById("hideitembutton").style.display = 'none';}
    };

      var element = document.getElementById('invoicee');
      html2pdf().from(element).set({
      margin:       [5, 15, 15, 5],
       // margin:       [t, l, b, r],
        // margin:       [10, 10, 20, 10],
        filename: '{{inv.Invoice_No}}',
        html2canvas: { dpi: 192, letterRendering: true, scale:5},
        image: { type: 'jpeg', quality: 1.5},
       pageBreak: { mode: 'css', before:'#nextpage1'},
        jsPDF: {unit: 'mm', format: [275, 210]}
      }).toPdf().get('pdf').then(function (pdf) {
        var totalPages = pdf.internal.getNumberOfPages();

        for (i = 1; i <= totalPages; i++) {
         pdf.setPage(i);
          pdf.setFontSize(9);
          pdf.setTextColor(150);
          if ( totalPages > 1){
          pdf.text(i + ' of ' + totalPages, (pdf.internal.pageSize.getWidth()/1.07), (pdf.internal.pageSize.getHeight()-5));}

          }}).save();
        
        setTimeout(func, 1000);
        function func() {location.href='/{{pdata.pj}}/invoice/edit/'+{{inv.id}}+'/'+{{inv.Order.id}}+'/'+'itemid/msg/'}
    }
    document.getElementById('btnTest').onclick = test;
  </script>

  <script type="text/javascript">
    window.onload = function () {
      
      if ('{{msg}}' != 'msg' ) {
      $('.widget-content .message', function () {
        swal({
            title: 'Return Message !',
            text: '{{msg}}',
            padding: '2em',
            allowOutsideClick: false,
            // type:'warning',
            confirmButtonText: 'OK',
          }).then((result) => {
  if (result.value) {location.href='/{{pdata.pj}}/invoice/edit/'+{{inv.id}}+'/'+{{inv.Order.id}}+'/'+'itemid/msg/';}})
      }) };

      if ('{{fnc}}' == 'create') {location.href='/{{pdata.pj}}/invoice/edit/'+{{inv.id}}+'/'+{{inv.Order.id}}+'/'+'itemid/msg/'};
     if ('{{item_id}}' != 'itemid') {
      document.getElementById('itemidclick').click(); 
      document.getElementById("itemaction").action = '/{{pdata.pj}}/edit/invoiceitem/'+{{inv.id}}+'/'+{{item_id}}+'/';}
    }
  </script>

  <script type="text/javascript">
    window.history.forward();
    function noBack()
    {
        window.history.forward();
    }
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.debug.js" ></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" ></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>
  
  <script src="{% static 'js/vendor.bundle.base.js' %}"></script>
  <script src="{% static 'js/misc.js' %}"></script>
  <script src="{% static 'js/off-canvas.js' %}"></script>
  <script src="{% static 'js/hoverable-collapse.js' %}"></script>
  <script src="{% static 'js/sweetalert2.min.js' %}"></script>

  <script type="text/javascript">
   
  </script>

  </body>
</html>